DESCRIPTION COMPLÃˆTE POUR LA CRÃ‰ATION D'UNE API ANIME-SAMA
===========================================================

ğŸ¯ OBJECTIF PRINCIPAL :
CrÃ©er une API backend ultra performante capable de scraper le site https://anime-sama.fr pour fournir des donnÃ©es dâ€™anime en temps rÃ©el, sans fallback local, et compatible avec un frontend existant.

ğŸ“Œ Lâ€™API devra :
- Utiliser **Node.js** avec **axios** pour les requÃªtes et **cheerio** pour le parsing HTML.
- Utiliser des routes API compatibles **Vercel** (fichiers dans `api/`).
- Fournir des rÃ©ponses JSON structurÃ©es.
- ÃŠtre 100% en ligne, sans base de donnÃ©es locale.
- ÃŠtre dÃ©ployable sur **Vercel** directement avec `vercel.json`.
- GÃ©rer les erreurs, timeout, anti-bot et rotation d'agent utilisateur.

ğŸ§° TECHNOLOGIES Ã€ UTILISER :
- Node.js
- Axios
- Cheerio
- Vercel Functions (`api/*.js`)
- User-Agent rotation
- (Optionnel) lru-cache ou Redis pour cache temporaire

ğŸ—‚ STRUCTURE DU PROJET :
anime-sama-api/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ search.js
â”‚   â”œâ”€â”€ trending.js
â”‚   â”œâ”€â”€ anime/[id].js
â”‚   â”œâ”€â”€ seasons/[animeId].js
â”‚   â”œâ”€â”€ episodes/[animeId].js
â”‚   â”œâ”€â”€ seasons/index.js
â”‚   â”œâ”€â”€ episode/[episodeId].js
â”‚   â”œâ”€â”€ episode/[animeId]/[season]/[ep].js
â”‚   â””â”€â”€ embed.js
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ scraper.js
â”œâ”€â”€ package.json
â””â”€â”€ vercel.json

âš™ï¸ FICHIER package.json :
Contient les dÃ©pendances :
- axios
- cheerio
- cors (si CORS est nÃ©cessaire)

âš™ï¸ FICHIER vercel.json :
Configure les routes et les builds :
{
  "version": 2,
  "builds": [{ "src": "api/**/*.js", "use": "@vercel/node" }],
  "routes": [{ "src": "/api/(.*)", "dest": "/api/$1.js" }]
}

ğŸ”— ENDPOINTS ET FONCTIONNALITÃ‰S Ã€ IMPLÃ‰MENTER :

1. /api/search?query=naruto
   - MÃ©thode : GET
   - Fonction : Recherche un anime
   - Scraper : /catalogue?q=query
   - DonnÃ©es : id, titre, image

2. /api/trending
   - Scrape la page dâ€™accueil
   - Retourne les animes tendance

3. /api/anime/:id
   - Scrape la fiche dÃ©taillÃ©e dâ€™un anime (synopsis, genres, etc.)

4. /api/seasons/:animeId
   - Retourne les saisons disponibles pour un anime

5. /api/episodes/:animeId?season=1&language=VOSTFR
   - Retourne la liste dâ€™Ã©pisodes dâ€™une saison et d'une langue

6. /api/seasons?animeId=xxx&season=1&language=VF&server=eps1
   - Endpoint principal pour les Ã©pisodes
   - Retourne les Ã©pisodes d'une saison spÃ©cifique

7. /api/episode/:episodeId
   - Retourne les sources de streaming pour un Ã©pisode prÃ©cis

8. /api/episode/:animeId/:season/:episode
   - Retourne les liens selon lâ€™anime, la saison et lâ€™Ã©pisode

9. /api/embed?url=https%3A%2F%2Fanime-sama.fr%2Fcatalogue%2F...
   - GÃ©nÃ¨re une page HTML dâ€™intÃ©gration (lecteur vidÃ©o embarquÃ©)

ğŸ›¡ COMPORTEMENT SÃ‰CURISÃ‰ :
- GÃ©rer les erreurs 400 et 500
- Timeout axios (8s)
- Rotation User-Agent
- Scraping passif avec dÃ©lais alÃ©atoires (setTimeout)
- Ne jamais stocker en base, tout est en direct depuis le site cible

ğŸš€ DÃ‰PLOIEMENT :
- Installer Vercel CLI
- `vercel login`
- `vercel deploy`

Exemple dâ€™URL : 
https://anime-sama-api.vercel.app/api/search?query=naruto

âœ… EXEMPLE DE RÃ‰PONSE POUR /api/search?query=naruto :

[
  {
    "id": "naruto",
    "title": "Naruto",
    "image": "https://anime-sama.fr/cdn/images/naruto.jpg"
  },
  {
    "id": "naruto-shippuden",
    "title": "Naruto Shippuden",
    "image": "https://anime-sama.fr/cdn/images/naruto-shippuden.jpg"
  }
]

ğŸ“¦ FIN DE LA DESCRIPTION

Document gÃ©nÃ©rÃ© le : 2025-06-28